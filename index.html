<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Taiwan News Monitor</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
    }

    h1 {
      color: #2c3e50;
    }

    ul {
      padding-left: 1rem;
    }

    .canadian-news {
      color: #003366;
      /* 深藍色 */
      font-weight: bold;
    }

    .non-canadian-news {
      color: #3399cc;
      /* 淺藍色 */
      font-weight: normal;
    }

    .width-control {
      max-width: 80vw;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <h1>Taiwan News Monitor</h1>
  <p>以下是最近抓到的新聞，依照日期分類：</p>
  <ol id="news">Loading...</ol>
<script>
  async function loadNews() {
    const res = await fetch("data/news.json");
    const data = await res.json();

    const now = new Date();
    const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);

    // 過濾只保留 7 天內的新聞
    const filteredArticles = data.articles.filter(article => {
      const publishedDate = new Date(article.published);
      return publishedDate >= sevenDaysAgo;
    });

    // 排序
    filteredArticles.sort((a, b) => new Date(b.published) - new Date(a.published));

    // 分類
    const groupedByDate = {};
    filteredArticles.forEach(article => {
      const date = article.date || article.published?.split("T")[0] || "未知日期";
      if (!groupedByDate[date]) groupedByDate[date] = [];
      groupedByDate[date].push(article);
    });

    // 加拿大媒體關鍵字
    const canadianMediaKeywords = [
      "CBC", "Radio-Canada", "Global News", "CTV News", "National Post",
      "Canadian Press", "APTN", "CPAC", "Ottawa Citizen", "Ottawa Sun",
      "CityNews", "Hill Times", "Ottawa Business Journal", "Daily Courier",
      "Penticton Herald", "The Intelligencer", "Brantford Expositor",
      "Recorder and Times", "Chatham Daily News", "Standard Freeholder",
      "Journal de Québec", "La Tribune", "Le Nouvelliste", "Le Quotidien",
      "The Guardian", "Journal Pioneer", "Western Star", "Evening News",
      "Sault Star", "Sudbury Star"
    ];

    const container = document.getElementById("news");
    container.innerHTML = "";

    for (const [date, articles] of Object.entries(groupedByDate)) {
      const section = document.createElement("section");
      const heading = document.createElement("h2");
      heading.textContent = date;
      section.appendChild(heading);

      const ol = document.createElement("ol");
      articles.forEach(article => {
        const li = document.createElement("li");

        // 判斷是否為加拿大媒體（title 中是否包含關鍵字）
        const foundMedia = canadianMediaKeywords.find(keyword =>
          article.title.toLowerCase().includes(keyword.toLowerCase())
        );

        const isCanadian = Boolean(foundMedia);
        const className = isCanadian ? "canadian-news" : "non-canadian-news";

        // 媒體名稱（從 title 中猜出來，否則用 article.source）
        const mediaName = foundMedia || article.source || "未知媒體";

        // 顯示媒體名稱
        const p1 = document.createElement("p");
        p1.textContent = mediaName;
        p1.className = className;

        // 顯示標題 + 連結
        const p2 = document.createElement("p");
        p2.className = className;
        const a = document.createElement("a");
        a.href = article.url;
        a.textContent = article.title;
        a.className = "width-control";
        a.target = "_blank";
        p2.appendChild(a);

        li.appendChild(p1);
        li.appendChild(p2);
        li.appendChild(document.createElement("hr"));

        ol.appendChild(li);
      });

      section.appendChild(ol);
      container.appendChild(section);
    }
  }

  loadNews();
</script>
</body>

</html>